# Fixing 404 Error on Vercel

## The Problem
Getting `404: NOT_FOUND` when accessing API routes on Vercel.

## Most Likely Causes

1. **Function not deployed** - Check Vercel dashboard → Functions tab
2. **Routing configuration** - Verify `vercel.json` rewrites
3. **Missing dependencies** - Check `api/requirements.txt` includes `mangum`
4. **Path resolution** - Backend files not accessible in Vercel environment

## Immediate Fix Steps

### Step 1: Verify Files Are Committed
```bash
git status
# Ensure these are committed:
# - api/index.py
# - api/requirements.txt  
# - backend/server.py
# - vercel.json
```

### Step 2: Check Vercel Build Logs
1. Go to Vercel Dashboard
2. Click on your project
3. Go to "Deployments" tab
4. Click on latest deployment
5. Check "Build Logs" and "Function Logs"

Look for:
- Python function build errors
- Import errors
- Missing file errors

### Step 3: Test API Endpoint
Try accessing:
```
https://your-app.vercel.app/api/
```

Should return: `{"message": "TrueData Analytics API"}`

### Step 4: Check Environment Variables
In Vercel Dashboard → Settings → Environment Variables, ensure:
- `MONGO_URL` is set (required for app to start)
- `DB_NAME` is set
- `CORS_ORIGINS` is set

**Important:** If `MONGO_URL` is missing, the app will fail to start and return 404.

### Step 5: Redeploy
After making changes:
```bash
git add .
git commit -m "Fix API routing"
git push
# Vercel will auto-deploy
```

Or manually:
```bash
vercel --prod
```

## Debugging

The current `api/index.py` includes debug output. Check Vercel Function Logs to see:
- Current directory
- Backend path
- Whether files exist
- Import errors

## Alternative Solution: Check Function Logs

1. Go to Vercel Dashboard → Your Project
2. Click "Functions" tab
3. Click on `api/index.py`
4. Check "Logs" tab
5. Look for error messages

Common errors:
- `ModuleNotFoundError` → Missing dependency in `requirements.txt`
- `FileNotFoundError` → Backend files not included
- `ImportError` → Path resolution issue

## Quick Test

Create a simple test endpoint by temporarily modifying `api/index.py`:

```python
from fastapi import FastAPI
from mangum import Mangum

app = FastAPI()

@app.get("/")
async def root():
    return {"message": "API is working", "status": "ok"}

@app.get("/api/")
async def api_root():
    return {"message": "TrueData Analytics API"}

handler = Mangum(app)
```

If this works, the issue is with importing `server.py`. If it doesn't, the issue is with Vercel configuration.

## Still Not Working?

If you're still getting 404 after these steps:

1. **Check Vercel Project Settings:**
   - Root Directory: Should be empty or `./`
   - Build Command: `cd frontend && npm install --legacy-peer-deps && npm run build`
   - Output Directory: `frontend/build`

2. **Verify File Structure:**
   ```
   your-repo/
   ├── api/
   │   ├── index.py          ← Must exist
   │   └── requirements.txt  ← Must exist
   ├── backend/
   │   └── server.py         ← Must exist
   └── vercel.json           ← Must exist
   ```

3. **Try Manual Deployment:**
   ```bash
   vercel --prod --force
   ```

4. **Contact Support:**
   - Check Vercel status page
   - Review Vercel documentation for Python functions
   - Check Vercel community forums

